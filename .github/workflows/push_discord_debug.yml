name: discord message (test with push)

on:
  push:
    branches:
      - main

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Prepare Discord message
        id: prepare_message
        run: |
          # ä½¿ç”¨ push äº‹ä»¶ä¸­çš„çœŸå®æ•°æ®
          full_msg="ğŸš€ **New Push to \`main\`**

**Repository:** ${{ github.repository }}
**Commit:** ${{ github.sha }}
**Author:** ${{ github.actor }}
**Message:** ${{ github.event.head_commit.message }}

[View Changes](${{ github.event.compare }})"

          # å®‰å…¨æˆªæ–­åˆ° 1990 å­—ç¬¦
          if [ ${#full_msg} -gt 1990 ]; then
            truncated_msg="${full_msg:0:1987}..."
          else
            truncated_msg="$full_msg"
          fi

          # è¾“å‡ºåˆ° GitHub Actions output
          echo "message<<EOF" >> "$GITHUB_OUTPUT"
          echo "$truncated_msg" >> "$GITHUB_OUTPUT"
          echo "EOF" >> "$GITHUB_OUTPUT"

      - name: Send to Discord
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK_URL }}
          DISCORD_USERNAME: Github Actions
          DISCORD_AVATAR: https://cdn.discordapp.com/avatars/1460099944252702846/e57fd67dc7ca0cc840a0e87a82281bc5.webp?size=80
        uses: Ilshidur/action-discord@0.4.0
        with:
          args: ${{ steps.prepare_message.outputs.message }}